CREATE TABLE SWIPE (
    EMPLOYEE_ID INT,
    ACTIVITY_TYPE VARCHAR(10),
    ACTIVITY_TIME DATETIME
);

-- INSERT SAMPLE DATA
INSERT INTO SWIPE (EMPLOYEE_ID, ACTIVITY_TYPE, ACTIVITY_TIME) VALUES
(1, 'LOGIN', '2024-07-23 08:00:00'),
(1, 'LOGOUT', '2024-07-23 12:00:00'),
(1, 'LOGIN', '2024-07-23 13:00:00'),
(1, 'LOGOUT', '2024-07-23 17:00:00'),
(2, 'LOGIN', '2024-07-23 09:00:00'),
(2, 'LOGOUT', '2024-07-23 11:00:00'),
(2, 'LOGIN', '2024-07-23 12:00:00'),
(2, 'LOGOUT', '2024-07-23 15:00:00'),
(1, 'LOGIN', '2024-07-24 08:30:00'),
(1, 'LOGOUT', '2024-07-24 12:30:00'),
(2, 'LOGIN', '2024-07-24 09:30:00'),
(2, 'LOGOUT', '2024-07-24 10:30:00');

SELECT * FROM SWIPE;

WITH EMP_LEVEL_LOGIN_LOGOUT_DATA AS 
(
SELECT EMPLOYEE_ID,ACTIVITY_TYPE,ACTIVITY_TIME AS LOGIN_TIME, 
LEAD(ACTIVITY_TIME) OVER(PARTITION BY EMPLOYEE_ID,DAY(ACTIVITY_TIME) ORDER BY DAY(ACTIVITY_TIME)) AS LOGOUT_TIME 
FROM SWIPE
)
,PRODUCTIVE_TIME AS (
SELECT *,DATEDIFF(HOUR,LOGIN_TIME,LOGOUT_TIME) AS PRODUCTIVE_HOURS FROM EMP_LEVEL_LOGIN_LOGOUT_DATA WHERE ACTIVITY_TYPE='LOGIN'
)
SELECT EMPLOYEE_ID,CAST(LOGIN_TIME AS DATE) AS [DATE],SUM(PRODUCTIVE_HOURS)
FROM PRODUCTIVE_TIME GROUP BY EMPLOYEE_ID,CAST(LOGIN_TIME AS DATE);
